<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>ホーム画面</title>
	<link rel="stylesheet" th:href="@{/css/home.css}">
	<link rel="stylesheet" th:href="@{/css/common/header.css}">
</head>

<body>
	<header class="hidden" th:replace="~{html/common/header :: layout-header}"></header>
	
	<!-- 固定ナビゲーションボタン（ページ最上部でのみ表示） -->
	<nav id="fixed-nav" class="fixed-nav">
		<a th:href="@{/card/list}" class="fixed-nav-link">カードリスト</a>
		<a th:href="@{/choice/leader}" class="fixed-nav-link">デッキ作成</a>
		<a th:href="@{/deck/list}" class="fixed-nav-link">デッキ一覧</a>
		<a th:href="@{/setting}" class="fixed-nav-link">設定</a>
		<a th:if="${session.role} == 'admin'" th:href="@{/admin/config}" class="fixed-nav-link admin-link">管理者設定</a>
	</nav>
	
	<!-- スプラッシュ（初回ログイン時のみ表示） -->
	<section id="splash-section" th:classappend="${showSplash} ? '' : 'hidden'">
		<div id="splash-content">
			<img th:src="@{/img/onepiececard_logo.png}" id="splash-logo">
		</div>
	</section>
	
	<main>
		<!-- ホーム画面 -->
		<section id="home-section" th:classappend="${showSplash} ? 'hidden' : ''">
			<div class="background-section section-1"></div>
			<div class="background-section section-2">
				<h2>ワンピースカードを楽しもう</h2>
				<p>
					本サイトはワンピースカードプレイヤーがより快適に、<br>
					そして自分らしい戦い方を追求できるようサポートすることを目指しています。<br><br>
					デッキ構築やカード検索を素早く行える環境を整え、<br>
					対戦準備の負担を減らし、<br>
					プレイに集中できる時間を増やすことに努めています。<br><br>
					プレイヤーの挑戦を後押しできるよう、<br>
					機能や情報の拡充にも継続して取り組み、<br>
					より良い体験を提供していきます。
				</p>
			</div>
			<div class="background-section section-3">
				<video class="section-3-video" autoplay muted loop playsinline>
				    <source th:src="@{/video/onepiece_video_1.mp4}" type="video/mp4">
				    お使いのブラウザは動画タグをサポートしていません。
				</video>
			</div>
			<div class="background-section section-4">
				<div class="news-container">
					<h2 class="section-title">NEWS<span class="section-subtitle">最新情報</span></h2>
					<div class="news-grid">
						<div th:each="news : ${latestNews}" class="news-card">
							<a th:href="@{/news/detail/{id}(id=${news.id})}" class="news-link">
								<div class="news-image">
									<img th:src="@{/file/news/{id}(id=${news.id})}" th:alt="NoImage">
								</div>
								<div class="news-content">
									<div class="news-meta">
										<span class="news-date" th:text="${#temporals.format(news.publishedDate, 'yyyy.MM.dd')}"></span>
										<span class="news-category" th:text="${news.category}"></span>
									</div>
									<h3 class="news-card-title" th:text="${news.title}"></h3>
								</div>
							</a>
						</div>
					</div>
					<div class="news-more">
						<a th:href="@{/news/list}" class="news-more-btn">お知らせ一覧へ</a>
					</div>
				</div>
			</div>
			<div class="background-section section-5">
				<div class="character-container">
					<h2 class="section-title">CHARACTER<span class="section-subtitle">キャラクター紹介</span></h2>
					
					<div class="character-carousel">
						<!-- 左矢印ボタン -->
						<button class="carousel-btn prev-btn" id="prevBtn">
							<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="15 18 9 12 15 6"></polyline>
							</svg>
						</button>
						
						<!-- キャラクター表示エリア -->
						<div class="character-display">
							<div class="character-card active" data-character="0">
								<div class="character-image">
									<img th:src="@{/img/character_borsalino.jpg}" alt="ボルサリーノ">
								</div>
								<div class="character-info">
									<h3 class="character-name">ボルサリーノ</h3>
									<p class="character-description">
										海軍大将。ピカピカの実の能力者で、<br>
										光速の動きと飄々とした口調が特徴。<br>
										"どっちつかずの正義"を掲げており、<br>
										任務は淡々と遂行する冷静な人物。
									</p>
									<button class="voice-btn" data-audio="Borsalino">
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
											<path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
											<path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
										</svg>
										ボイスを聴く
									</button>
								</div>
							</div>
							
							<div class="character-card" data-character="1">
								<div class="character-image">
									<img th:src="@{/img/character_urouge.png}" alt="ウルージ">
								</div>
								<div class="character-info">
									<h3 class="character-name">ウルージ</h3>
									<p class="character-description">
										麦わらの一味戦闘員。三刀流の剣士。<br>
										世界最強の剣豪を目指している。<br>
										クールで寡黙だが、仲間への信頼は厚い。<br>
										方向音痴という意外な一面も持つ。
									</p>
									<button class="voice-btn" data-audio="Urouge">
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
											<path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
											<path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
										</svg>
										ボイスを聴く
									</button>
								</div>
							</div>
							
							<div class="character-card" data-character="2">
								<div class="character-image">
									<img th:src="@{/img/character_higuma.png}" alt="緋熊">
								</div>
								<div class="character-info">
									<h3 class="character-name">緋熊</h3>
									<p class="character-description">
										麦わらの一味航海士。天候を読む天才的な才能を持つ。<br>
										世界中の海図を描くことが夢。<br>
										お金が大好きで、金銭感覚にはシビア。<br>
										仲間を守るためには命を賭ける覚悟がある。
									</p>
									<button class="voice-btn" data-audio="Higuma">
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
											<path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
											<path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
										</svg>
										ボイスを聴く
									</button>
								</div>
							</div>
							
							<div class="character-card" data-character="3">
								<div class="character-image">
									<img th:src="@{/img/character_shirohige.png}" alt="白ひげ">
								</div>
								<div class="character-info">
									<h3 class="character-name">白ひげ</h3>
									<p class="character-description">
										麦わらの一味航海士。天候を読む天才的な才能を持つ。<br>
										世界中の海図を描くことが夢。<br>
										お金が大好きで、金銭感覚にはシビア。<br>
										仲間を守るためには命を賭ける覚悟がある。
									</p>
									<button class="voice-btn" data-audio="Shirohige">
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
											<path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
											<path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
										</svg>
										ボイスを聴く
									</button>
								</div>
							</div>
						</div>
						
						<!-- 右矢印ボタン -->
						<button class="carousel-btn next-btn" id="nextBtn">
							<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="9 18 15 12 9 6"></polyline>
							</svg>
						</button>
					</div>
					
					<!-- インジケーター -->
					<div class="carousel-indicators">
						<span class="indicator active" data-index="0"></span>
						<span class="indicator" data-index="1"></span>
						<span class="indicator" data-index="2"></span>
						<span class="indicator" data-index="3"></span>
					</div>
				</div>
			</div>
		</section>
	</main>
	
	<script th:inline="javascript">
		document.addEventListener("DOMContentLoaded", () => {
			const header = document.querySelector("header");
			const fixedNav = document.getElementById("fixed-nav");
			const scrollThreshold = 50;
			const showSplash = /*[[${showSplash}]]*/ false;
			
			if (showSplash) {
				// スプラッシュ表示中はスクロールを無効化
				document.body.style.overflow = "hidden";
				
				// ロゴのアニメーションが終わるころに実行（3秒）
				setTimeout(() => {
					const splash = document.getElementById("splash-section");
					const home = document.getElementById("home-section");
					
					// スプラッシュ画面をフェードアウト
					splash.style.opacity = "0";
					splash.style.transition = "opacity 0.5s ease";
					
					// スプラッシュ画面を完全に非表示にしてからホーム画面を表示
					setTimeout(() => {
						splash.style.display = "none";
						
						// スクロールを再度有効化
						document.body.style.overflow = "auto";
						
						// ヘッダーを表示可能にする（最初は非表示状態）
						if (header) {
							header.classList.remove("hidden");
							header.classList.add("header-hidden");
						}
						home.classList.remove("hidden");
						
						// 固定ナビゲーションを表示
						if (fixedNav) {
							fixedNav.classList.add("show");
						}
						
						// 次のタイミングでホーム画面をフェードイン
						setTimeout(() => {
							home.classList.add("show");
						}, 10);
					}, 500);
					
				}, 3000);
			} else {
				// スプラッシュなしの場合は即座に表示
				const home = document.getElementById("home-section");
				document.body.style.overflow = "auto";
				
				if (header) {
					header.classList.remove("hidden");
					header.classList.add("header-hidden");
				}
				
				home.classList.remove("hidden");
				home.classList.add("show");
				
				if (fixedNav) {
					fixedNav.classList.add("show");
				}
			}
			
			// スクロールに応じてヘッダーと固定ナビゲーションの表示/非表示を切り替え
			window.addEventListener("scroll", () => {
				const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
				
				if (scrollTop <= scrollThreshold) {
					// 最上部付近ではヘッダーを非表示、固定ナビゲーションを表示
					if (header) {
						header.classList.add("header-hidden");
					}
					if (fixedNav) {
						fixedNav.classList.add("show");
					}
				} else {
					// スクロールしたらヘッダーを表示、固定ナビゲーションを非表示
					if (header) {
						header.classList.remove("header-hidden");
					}
					if (fixedNav) {
						fixedNav.classList.remove("show");
					}
				}
				
				// section-2のテキストアニメーション
				const section2 = document.querySelector('.section-2');
				const section2Text = document.querySelectorAll('.section-2 h2, .section-2 p');
				
				if (section2) {
					const section2Top = section2.getBoundingClientRect().top;
					const windowHeight = window.innerHeight;
					
					// section-2が画面の半分まで来たら表示
					if (section2Top < windowHeight / 2) {
						section2Text.forEach(el => {
							el.classList.add('show');
						});
					}
				}
			});
		});
		
		document.addEventListener("DOMContentLoaded", () => {
			let currentIndex = 0;
			const cards = document.querySelectorAll('.character-card');
			const indicators = document.querySelectorAll('.indicator');
			const totalCards = cards.length;
			
			// 音声データのマップ（各キャラクターに複数のボイス）
			const audioFiles = {
				Borsalino: [
					'/audio/borsalino_voice_1.mp3',
					'/audio/borsalino_voice_2.mp3',
					'/audio/borsalino_voice_3.mp3',
					'/audio/borsalino_voice_4.mp3'
				],
				Urouge: [
					'/audio/urouge_voice_1.mp3',
					'/audio/urouge_voice_2.mp3',
					'/audio/urouge_voice_3.mp3',
					'/audio/urouge_voice_4.mp3'
				],
				Higuma: [
					'/audio/higuma_voice_1.mp3',
					'/audio/higuma_voice_2.mp3',
					'/audio/higuma_voice_3.mp3',
					'/audio/higuma_voice_4.mp3'
				],
				Shirohige: [
					'/audio/shirohige_voice_1.mp3',
					'/audio/shirohige_voice_2.mp3',
					'/audio/shirohige_voice_3.mp3',
					'/audio/shirohige_voice_4.mp3'
				]
			};
			
			// 各キャラクターの現在のボイスインデックスを管理
			const voiceIndexes = {
				Borsalino: 0,
				Urouge: 0,
				Higuma: 0,
				Shirohige: 0
			};
			
			function showCard(index) {
				cards.forEach(card => card.classList.remove('active'));
				indicators.forEach(indicator => indicator.classList.remove('active'));
				
				cards[index].classList.add('active');
				indicators[index].classList.add('active');
			}
			
			document.getElementById('nextBtn').addEventListener('click', () => {
				currentIndex = (currentIndex + 1) % totalCards;
				showCard(currentIndex);
			});
			
			document.getElementById('prevBtn').addEventListener('click', () => {
				currentIndex = (currentIndex - 1 + totalCards) % totalCards;
				showCard(currentIndex);
			});
			
			indicators.forEach(indicator => {
				indicator.addEventListener('click', () => {
					currentIndex = parseInt(indicator.dataset.index);
					showCard(currentIndex);
				});
			});
			
			// ボイスボタンのクリックイベント
			document.querySelectorAll('.voice-btn').forEach(btn => {
				btn.addEventListener('click', () => {
					const audioKey = btn.dataset.audio;
					const voiceList = audioFiles[audioKey];
					
					// 既存の音声を停止
					const existingAudio = document.querySelector('audio.character-voice');
					if (existingAudio) {
						existingAudio.pause();
						existingAudio.remove();
					}
					
					// 現在のボイスインデックスを取得
					const currentVoiceIndex = voiceIndexes[audioKey];
					const audioPath = voiceList[currentVoiceIndex];
					
					// 次のボイスに進める（ループ）
					voiceIndexes[audioKey] = (currentVoiceIndex + 1) % voiceList.length;
					
					// 新しい音声を再生
					const audio = new Audio(audioPath);
					audio.className = 'character-voice';
					audio.play().catch(err => {
						console.log('音声の再生に失敗しました:', err);
						alert('音声ファイルが見つかりません');
					});
				});
			});
		});
	</script>
</body>

</html>